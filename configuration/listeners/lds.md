# 监听器发现服务（LDS）

监听器发现服务（LDS）是Envoy动态调用获取侦听器的可选API。Envoy将根据需要协调API响应并添加，修改或删除已知的监听器。

监听器更新的语义如下：

* 每个监听器必须具有唯一的[名称](TODO:)。如果没有提供名称，Envoy将创建一个UUID。要动态更新的侦听器应具有管理服务器提供的唯一名称。
* 当添加一个监听器后，它将在获取流量之前被“加热”。例如，如果监听器引用RDS配置，监听器状态变更到“活动”之前解析并获取该配置。
* 一旦创建，监听器就会保持不变。因此，当更新侦听器时，将创建一个全新的监听器（使用相同的监听socket）。对于新添加的监听器，该监听器经历上述相同的加热过程。
* 更新或删除监听器时，旧监听器将处于“耗尽”状态，就像整个服务器耗尽以便重新启动一样。 在删除监听器并关闭任何其余连接之前，监听器拥有的连接将在一段时间内正常关闭（如果可能）。 耗尽时间通过`--drain-time-s`选项设置。

```
注：
无法通过LDS API修改或删除在Envoy配置中静态定义的任何侦听器。
```

## 配置

* [v1 LDS API](TODO:)
* [v2 LDS API](TODO:)

## 统计

## 监听管理器

LDS有一个以* listener_manager.lds.* 为根的统计树，以下是统计数据。

|名称|类型|描述|  
|----|---|---|
|config_reload|计数器|由于配置不同导致配置重新加载获取的API总量|
|update_attempt|计数器|尝试获取API总量|
|update_success|计数器|成功完成获取API总量|
|update_failure|计数器|获取API失败总数（网络或schema错误）|
|version|计量器|上次成功获取API的内容的哈希值|
